<div align="center">

#  <img src="https://www.bilibili.com/favicon.ico" width="30" height="30" style="vertical-align: text-bottom;">  <a href="https://greasyfork.org/zh-CN/scripts/487532-%E5%93%94%E5%93%A9%E5%93%A9%E5%93%A9%E5%93%A9%E6%94%B6%E8%97%8F%E5%A4%B9%E5%AF%BC%E5%87%BA" style="text-decoration: none;"> Bilibili-Favlist-Export </a>

#### **ç®€ä½“ä¸­æ–‡** | <a href="https://github.com/AHCorn/Bilibili-Favlist-Export/blob/main/README_EN.md"> English </a>

å¯¼å‡ºå“”å“©å“”å“©æ”¶è—å¤¹ä¸º CSV æˆ– HTML æ–‡ä»¶ï¼Œä»¥ä¾¿å¯¼å…¥ Raindrop æˆ– Firefox

![JavaScript](https://img.shields.io/badge/javascript-%23323330.svg?style=for-the-badge&logo=javascript&logoColor=%23F7DF1E)
![GitHub stars](https://img.shields.io/github/stars/AHCorn/Bilibili-Favlist-Export?style=for-the-badge)
![GitHub issues](https://img.shields.io/github/issues/AHCorn/Bilibili-Favlist-Export?style=for-the-badge)
![GitHub pull requests](https://img.shields.io/github/issues-pr/AHCorn/Bilibili-Favlist-Export?style=for-the-badge)
![GitHub forks](https://img.shields.io/github/forks/AHCorn/Bilibili-Favlist-Export?style=for-the-badge)

</div>

<br>

## âš  ç”¨å‰é¡»çŸ¥

æœ¬è„šæœ¬æ‰€ä½¿ç”¨çš„ CSV æ ¼å¼ä¸º Raindrop æ‰€è¦æ±‚çš„æ ¼å¼ï¼ŒHTML ä¸º Firefox æ‰€ä½¿ç”¨çš„å¤‡ä»½æ ¼å¼ï¼Œå¯¹äºå…¶å®ƒæµè§ˆå™¨å…¼å®¹æ€§æœªçŸ¥ã€‚

å¯¼å‡ºé€Ÿåº¦å›ºå®šåœ¨ä»£ç ä¸­çš„ ``` const DELAY = 2000; ``` éƒ¨åˆ†ï¼Œå¦‚æœæ‚¨çš„åŠ è½½é€Ÿåº¦è¶³å¤Ÿï¼Œå¯ä»¥é™ä½å»¶æ—¶ã€‚

å¦‚æœæ‚¨å‡ºç°äº†æ”¶è—å¤¹é”™ä½çš„æƒ…å†µï¼Œåˆ™æ˜¯ç½‘ç»œæ¡ä»¶å’Œå¯¼å‡ºå»¶æ—¶ä¸åŒ¹é…ã€‚

è‹¥æ‚¨å¸Œæœ›ä¸  æ”¶è—å¤¹Fix ä¸€èµ·ä½¿ç”¨ï¼Œè¯·è‡³å°‘å¢åŠ è‡³ 4000 å»¶æ—¶ä»¥ç­‰å¾…è„šæœ¬åŠ è½½ã€‚


<br>

## â­ ç‰¹æ€§
1. æ‹¥æœ‰ç‹¬ç«‹çš„å¯¼å‡ºé¢æ¿ã€‚
2. è‡ªåŠ¨éå†æ‰€æœ‰æ”¶è—å¤¹è§†é¢‘ã€‚
3. æ”¯æŒç”¨æˆ·è‡ªé€‰å¯¼å‡ºæ ¼å¼ã€‚
4. æ”¯æŒç”¨æˆ·è‡ªé€‰å¯¼å‡ºå†…å®¹ï¼ˆCSVï¼‰ã€‚
5. æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰çˆ¶çº§ä¹¦ç­¾æ–‡ä»¶å¤¹ï¼ˆHTMLï¼‰ã€‚
6. å®æ—¶æŸ¥çœ‹å¯¼å‡ºè¿›åº¦ã€‚
   
<br>


## ğŸ’» ä½¿ç”¨
è¯¥ç‰ˆæœ¬æ˜¯ [Bilibili-To-Raindrop](https://github.com/AHCorn/Bilibili-To-Raindrop) çš„è¡ç”Ÿç‰ˆæœ¬ï¼Œæ“ä½œæ›´ä¸ºä¾¿æ·ï¼Œæ”¯æŒæ ¼å¼å’Œè‡ªå®šä¹‰ç¨‹åº¦æ›´å¹¿ã€‚

å¦‚æœæ‚¨ä»…éœ€è¦å¯¼å‡ºè‡³Raindropæ ¼å¼æ‰€éœ€çš„CSVæ–‡ä»¶ï¼Œè¿½æ±‚å…¼å®¹æ€§å’Œé€Ÿåº¦ï¼Œå¯ä»¥ä¸å®‰è£…æ²¹çŒ´è„šæœ¬ç›´æ¥ä½¿ç”¨æ§åˆ¶å°è„šæœ¬ã€‚

åœ¨å“”å“©å“”å“©æ”¶è—å¤¹é¡µé¢æŒ‰ä¸‹ F12ï¼Œæˆ–å³é”®ç½‘é¡µé€‰ä¸­æ£€æŸ¥ï¼Œå¹¶å°†ä»¥ä¸‹ä»£ç ç²˜è´´è‡³æµè§ˆå™¨æ§åˆ¶å°ï¼ˆconsoleï¼‰ä¸­
```js
var delay = 2000; //ç­‰å¾…æ—¶é—´
var gen = listGen();
var csvContent = "\uFEFF";
csvContent += "folder,title,url,created\n";

function getCSVFileName() {
    let userName = document.querySelector(".nickname").innerHTML;
    return userName + "çš„æ”¶è—å¤¹.csv";
}

function getFolderName() {
    return document.querySelector(".favlist-info-detail__title .vui_ellipsis").innerHTML;
}

function escapeCSV(field) {
    return '"' + String(field).replace(/"/g, '""') + '"';
}

function getVideosFromPage() {
    var results = [];
    var folderName = getFolderName().replace(/\//g, '\\');
    document.querySelectorAll(".fav-list-main .items__item").forEach(function (item) {
        var titleElement = item.querySelector(".bili-video-card__title");
        var title = titleElement.title.replace(/,/g, '');
        if (title !== "å·²å¤±æ•ˆè§†é¢‘") {
            let url = item.querySelector(".bili-video-card__title a").href
            let subtitleLink = item.querySelector(".bili-video-card__subtitle a")
            let timeText = ''
            if (subtitleLink) // ä¸€èˆ¬è§†é¢‘
                timeText = subtitleLink.querySelector("div:last-child>span").title
            else { // é“¾æ¥ä¸å¯ç‚¹å‡»
                let subtitle = item.querySelector(".bili-video-card__subtitle>span").title
                if (subtitle.includes("æ”¶è—äº")) {// ç‰¹æ®Šè§†é¢‘ï¼Œå¦‚ç”µå½±
                    timeText = subtitle;
                    title = timeText.trim().split("Â·")[0].trim();
                }
                else { // æŸäº›è®¢é˜…åˆé›†ä¸­çš„è§†é¢‘
                    timeText = subtitle;
                    title = titleElement.title.replace(/,/g, '');
                }
            }
            var created = timeText.trim().split("Â·").slice(-1)[0].trim().slice(3);
            results.push(escapeCSV(folderName) + ',' + escapeCSV(title) + ',' + escapeCSV(url) + ',' + escapeCSV(created));
        }
    });
    return results.join('\n');
}

function processVideos() {
    csvContent += getVideosFromPage() + '\n';
    currentPage++;
    let turnPage = document.querySelector(".vui_pagenation--btn-side:last-child");
    if (currentPage < totalPage && turnPage) {
        turnPage.click();
        setTimeout(processVideos, delay);
    } else {
        setTimeout(changeList, delay);
    }
}

function* listGen() {
    const lists = document.querySelectorAll(".fav-collapse:nth-child(-n+2) .vui_collapse_item .fav-sidebar-item .vui_sidebar-item");
    for (let list of lists) {
        yield list;
    }
}

function changeList() {
    let list = gen.next().value;
    if (list) {
        list.click();
        setTimeout(() => {
            let PageCountDesc = document.querySelector(".vui_pagenation-go__count")
            if (PageCountDesc)
                totalPage = parseInt(PageCountDesc.innerHTML.match(/\d+/)[0]) || 1;
            currentPage = 0;
            processVideos();
        }, delay);
    } else {
        downloadCSV();
    }
}

function downloadCSV() {
    var fileName = getCSVFileName();
    var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    var url = URL.createObjectURL(blob);

    var win = window.open();
    if (win) {
        win.document.open();
        win.document.write('<html><body>');
        win.document.write('<a href="' + url + '" download="' + fileName + '">ç‚¹å‡»ä¸‹è½½</a>');
        win.document.write('<script>document.querySelector("a").click();</script>');
        win.document.write('</body></html>');
        win.document.close();
    } else {
        alert('ä¸‹è½½çª—å£è¢«æµè§ˆå™¨é˜»æ­¢ï¼Œè¯·å…ˆåœ¨è®¾ç½®é‡Œå…è®¸ç½‘é¡µå¼¹çª—åé‡è¯•ã€‚');
    }
}

changeList();

```


## â¤ï¸ æ„Ÿè°¢
åŸå§‹è·å–ä»£ç æ¥è‡ªäº [å¿«é€Ÿå¯¼å‡ºBç«™æ”¶è—å•èŠ‚ç›®åˆ—è¡¨ - é±¼è‚‰çœŸå¥½åƒ](https://www.cnblogs.com/toumingbai/p/11399238.html)

éå†æ‰€æœ‰æ”¶è—å¤¹éƒ¨åˆ†çš„ä»£ç æ¥è‡ªäº [BiliBackup](https://github.com/sweatran/BiliBackup?tab=readme-ov-file)

